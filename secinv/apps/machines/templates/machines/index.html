{% extends "machines/base.html" %}
{% load i18n %}

{% block head_title %}{{ _('Machines') }} | {{ block.super }}{% endblock %}

{% block content %}
      <hgroup id="masthead">
        <h2>{{ _('Machines') }}</h2>
{% if machines.object_list %}
        <h3 class="pagination">
          <span class="current">
          {% blocktrans with machines.number as page_num with machines.paginator.num_pages as page_count  %}
            Page {{ page_num }} of {{ page_count }}
          {% endblocktrans %}
          </span>

          <span class="step-links">
          {% if machines.has_previous %}
            <a href="?page={{ machines.previous_page_number }}">&larr; {{ _('Previous') }}</a>
          {% endif %}

          {% if machines.has_next %}
            <a href="?page={{ machines.next_page_number }}">{{ _('Next') }} &rarr;</a>
          {% endif %}
          </span>
        </h3>
{% endif %}
      </hgroup>

{% if machines.object_list %}
      <table class="wide">
        <caption>{{ _('Machines') }}</caption>
        <thead>
          <tr>
            <th>{{ _('IP') }}</th>
            <th>{{ _('Hostname') }}</th>
            <th>{{ _('External IP') }}</th>
            <th>{{ _('httpd') }}</th>
            <th>{{ _('mysqld') }}</th>
            <th>{{ _('openvpn') }}</th>
            <th>{{ _('NFS') }}</th>
            <th>{{ _('Added') }}</th>
            <!--<th>{{ _('Modified') }}</th>-->
            <th>{{ _('Scanned') }}</th>
          </tr>
        </thead>
        <tbody>
      {% for machine in machines.object_list %}
          <tr>
            <td>{{ machine.sys_ip }}</td>
            <td>
              <a href="{% url machines-detail machine_slug=machine.hostname %}">
                {{ machine.hostname }}
              </a>
            </td>
            <td>{% if machine.ext_ip == 'None' %}{{ machine.ext_ip }}{% endif %}</td>
            <td title="{% if machine.httpd %}{{ _('enabled') }}{% else %}{{ _('disabled') }}{% endif %}"
                class="{% if machine.httpd %}enabled{% else %}disabled{% endif %}">
              <mark>{% if machine.httpd %}&#10004;{% else %}&#10006;{% endif %}</mark>
            </td>
            <td title="{% if machine.mysqld %}{{ _('enabled') }}{% else %}{{ _('disabled') }}{% endif %}"
                class="{% if machine.mysqld %}enabled{% else %}disabled{% endif %}">
              <mark>{% if machine.mysqld %}&#10004;{% else %}&#10006;{% endif %}</mark>
            </td>
            <td title="{% if machine.openvpn %}{{ _('enabled') }}{% else %}{{ _('disabled') }}{% endif %}"
                class="{% if machine.openvpn %}enabled{% else %}disabled{% endif %}">
              <mark>{% if machine.openvpn %}&#10004;{% else %}&#10006;{% endif %}</mark>
            </td>
            <td title="{% if machine.nfs %}{{ _('yes') }}{% else %}{{ _('no') }}{% endif %}"
                class="{% if machine.nfs %}enabled{% else %}disabled{% endif %}">
              <mark>{% if machine.nfs %}&#10004;{% else %}&#10006;{% endif %}</mark>
            </td>
{# TODO: uniform date format #}
            <td>
              {% if machine.date_added %}
              <time datetime="{{ machine.date_added|date:'c' }}">
                {{ machine.date_added|date:'m/d/Y g:i a' }}
              </time>
              {% endif %}
            </td>
            <!--
            <td>
              {% if machine.date_modified %}
              <time datetime="{{ machine.date_modified|date:'c' }}">
                {{ machine.date_modified|date:'m/d/Y' }}
              </time>
              {% endif %}
            </td>
            -->
            <td>
              {% if machine.date_scanned %}
              <time datetime="{{ machine.date_scanned|date:'c' }}">
                {{ machine.date_scanned|date:'m/d/Y g:i a' }}
              </time>
              {% endif %}
            </td>
          </tr>
      {% endfor %}
        </tbody>
      </table>
{# TODO: Pagination #}
{% else %}
      <p>No machines are available.</p>
{% endif %}
{% endblock %}


