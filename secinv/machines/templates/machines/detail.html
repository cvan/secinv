{% extends "machines/base.html" %}
{% load i18n %}
{% load machine_extras %}

{% block head_title %}{{ machine.hostname }} | {{ block.super }}{% endblock %}

{% block content %}
      <h2><em>{{ machine.sys_ip }}</em> {{ machine.hostname }}</h2>

      <table>
        <caption>{{ _('Machine details') }}</caption>
        <tbody>
          <tr>
            <th>{{ _('IP address') }}</th>
            <td>
              <a href="http://ws.arin.net/whois/?queryinput={{ machine.sys_ip }}">
                {{ machine.sys_ip }}
              </a>
            </td>
          </tr>
          <tr>
            <th>{{ _('Hostname') }}</th>
            <td>{{ machine.hostname }}</td>
          </tr>
          <tr>
            <th>{{ _('External IP address') }}</th>
            <td>
              <a href="http://ws.arin.net/whois/?queryinput={{ machine.ext_ip }}">
                {{ machine.ext_ip }}
              </a>
            </td>
          </tr>
{# TODO: uniform date format #}
          <tr>
            <th>{{ _('Added') }}</th>
            <td>
              {% if machine.date_added %}
              <time datetime="{{ machine.date_added|date:'c' }}">
                {{ machine.date_added }}
              </time>
              {% endif %}
            </td>
          </tr>
          <tr>
            <th>{{ _('Modified') }}</th>
            <td>
            {% if machine.date_modified %}
              <time datetime="{{ machine.date_modified|date:'c'|default:'0000-00-00T00:00:00.000000' }}">
                {{ machine.date_modified }}
              </time>
            {% endif %}
            </td>
          </tr>
          <tr>
            <th>{{ _('Scanned') }}</th>
            <td>
              {% if machine.date_scanned %}
              <time datetime="{{ machine.date_scanned|date:'c' }}">
                {{ machine.date_scanned }}
              </time>
              {% endif %}
            </td>
          </tr>
        </tbody>
      </table>

      <h3>{{ _('System') }}</h3>
      <table>
        <caption>{{ _('Latest') }}</caption>
        <tbody>
          <tr>
            <th>{{ _('Kernel release') }}</th>
            <td{% if 'kernel_rel' in system.diff_split %} class="diff_changed"{% endif %}>{{ system.kernel_rel }}</td>
          </tr>
          <tr>
            <th>{{ _('RedHat release') }}</th>
            <td{% if 'rh_rel' in system.diff_split %} class="diff_changed"{% endif %}>{{ system.rh_rel }}</td>
          </tr>
          <tr>
            <th>{{ _('NFS mounted?') }}</th>
            <td{% if 'nfs' in system.diff_split %} class="diff_changed"{% endif %}>{{ system.nfs }}</td>
          </tr>
          <tr>
            <th>{{ _('Added') }}</th>
            <td>
              {% if system.date_added %}
              <time datetime="{{ system.date_added|date:'c' }}">
                {{ system.date_added }}
              </time>
              {% endif %}
            </td>
          </tr>
        </tbody>
      </table>

      <table>
        <caption>{{ _('Change history') }}</caption>
        <thead>
          <tr>
            <th>{{ _('Kernel release') }}</th>
            <th>{{ _('RedHat release') }}</th>
            <th>{{ _('NFS') }}</th>
            <th>{{ _('Date changed') }}</th>
          </tr>
        </thead>
        <tbody>
{% for system_h in system_history %}
          <tr>
            <td>{{ system_h.kernel_rel }}</td>
            <td>{{ system_h.rh_rel }}</td>
            <td>{{ system_h.nfs }}</td>
            <td>{{ system_h.date_modified }}</td>
          </tr>
{% empty %}
          <tr>
            <td></td>
          </tr>
{% endfor %}
        </tbody>
      </table>

{# TODO: Change history for services listening #}
      <table>
        <caption>{{ _('Services listening') }}</caption>
        <thead>
          <tr>
            <th>{{ _('Process') }}</th>
            <th>{{ _('Port') }}</th>
          </tr>
        </thead>
        <tbody>
      {% for service, port in services_list.items %}
          <tr>
            <td>{{ service }}</td>
            <td>{{ port }}</td>
          </tr>
      {% endfor %}
        </tbody>
      </table>
      <small>
<!--
        {{ _('Date added:') }} <time datetime="{{ services.date_added|date:'c' }}">
          {{ services.date_added }}
        </time>
-->
      </small>

{# TODO: Change history for RPMs #}
      <h3>RPMs</h3>
      {% if rpms %}
      <ul>
        {% for rpm in rpms %}
        <li>{{ rpm }}</li>
        {% endfor %}
      </ul>
      {% endif %}

{% if interfaces %}
      <table>
        <caption>{{ _('Interfaces') }}</caption>
        <thead>
          <tr>
            <th>{{ _('Interface name') }}</th>
            <th>{{ _('IP address') }}</th>
            <th>{{ _('MAC address') }}</th>
            <th>{{ _('Netmask') }}</th>
            <th>{{ _('Added') }}</th>
            <th>{{ _('Change history') }}</th>
          </tr>
        </thead>
        <tbody>
      {% for interface in interfaces %}
          <tr>
            <td>{{ interface.i_name }}</td>
            <td>
              <a href="http://ws.arin.net/whois/?queryinput={{ interface.i_ip }}">
                {{ interface.i_ip }}
              </a>
            </td>
            <td>{{ interface.i_mac }}</td>
            <td>{{ interface.i_mask }}</td>
            <td>
              {% if interface.date_added %}
              <time datetime="{{ interface.date_added|date:'c' }}">
                {{ interface.date_added }}
              </time>
              {% endif %}
            </td>
            <td>
{# TODO: Change history for this interface name #}
            </td>
          </tr>
      {% endfor %}
        </tbody>
      </table>
{% endif %}

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


{% endblock %}
